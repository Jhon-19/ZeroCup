<!DOCTYPE html>
<html lang="zh-cn" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>武大探险-牌坊</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="Shortcut Icon" href="https://s1.ax1x.com/2020/03/27/GPH9xO.png" type="image/png" />
    <style type="text/css">
    .hidden{
        display: none;
    }
    .game{
        background-color:rgba(255,255,255);
        position:fixed;
        top:0px;
        left:0px;
        width:100%;
        height:100%;
        z-index: -10;
    }
    </style>
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
</head>
<body style="margin:0px">
    <div style="margin-top:10px;margin-left:10px;">
        <a class="btn btn-primary" href="#">返回地图</a>
    </div>
    <div class="spinner-border text-primary" role="status" style="float:left;" id="loading">
        
    </div>
    <div style="float:left;padding:10px;font-size: 30px;">
        <p id="text">Loading...</p>
    </div>
    <span class="hidden" id="intro">
        1931年，一座四柱三间歇山式结构的木制牌坊竖立在街道口劝业场（珞珈山路靠近武珞路），但次年毁于龙卷风。这座牌坊为武大最早的牌坊。
        1934年，武大在原址建造钢筋水泥冲天式牌坊。四根八棱圆柱，表示喜迎来自四面八方的莘莘学子；柱头上的云纹和背面用小篆书写的“文法理工农医”六个大字。
        1992年，为迎接建校100周年，武大以民国老牌坊为蓝本，在八一路校门口兴建新的大门牌坊，老牌坊还在原址（珞珈山路靠近武珞路）于1993年教师节前建成；后于2012年拆除。
        2013年，八一路校门新牌坊落成。
    </span>
    <img src="image/paifang_bg.jpeg" id="paifang_bg" style="display: none;" />
    <img src="image/paifang_choice1.jpg" id="paifang_choice1" style="display: none;" />
    <img src="image/paifang_choice2.jpg" id="paifang_choice2" style="display: none;" />
    <img src="image/paifang_choice3.jpg" id="paifang_choice3" style="display: none;" />
    <img src="image/paifang_choice4.jpg" id="paifang_choice4" style="display: none;" />
    <img src="image/paifang_intro.png" id="paifang_intro" style="display: none;" />
<canvas id="game" class="hidden" onmousedown="doclick(event)">
</canvas>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script type="text/javascript">
    canv=document.getElementById("game");
    context=canv.getContext("2d");
    complete=false;
    progress=0;
    intro=document.getElementById("intro").innerText;
    window.onresize=renderCanvas;
    window.onload=function(){
        canv.className="game";
        document.getElementById("loading").remove();
        document.getElementById("text").innerHTML="";
        renderCanvas();
    }
    function displayIntro(){
        progress++;
        if(progress>intro.length)
            progress=intro.length;
        document.getElementById("text").innerText=intro.substring(0,progress);
    }
    function renderCanvas(){
        w=canv.width=canv.clientWidth;
        h=canv.height=canv.clientHeight;
        context.fillStyle="#FFFFFF";
        context.fillRect(0,0,w,h);
        renderBackgroundImg(document.getElementById("paifang_bg"));
        context.fillStyle="#FFFFFF70";
        context.fillRect(0,0,w,h);
        if(complete)
            return;
        ispc=canv.width>canv.height;
        if(ispc){
            drawImagePortion(document.getElementById("paifang_choice1"),0.05,0.05,0.2);
            drawImagePortion(document.getElementById("paifang_choice2"),0.35,0.05,0.2);
            drawImagePortion(document.getElementById("paifang_choice3"),0.65,0.05,0.2);
            drawImagePortion(document.getElementById("paifang_choice4"),0.65,0.5,0.2);
            drawImagePortion(document.getElementById("paifang_intro"),0.05,0.5,0.4);
        }else{
            drawImagePortion(document.getElementById("paifang_choice1"),0.05,0.05,0.4);
            drawImagePortion(document.getElementById("paifang_choice2"),0.55,0.05,0.4);
            drawImagePortion(document.getElementById("paifang_choice3"),0.05,0.35,0.4);
            drawImagePortion(document.getElementById("paifang_choice4"),0.55,0.35,0.4);
            drawImagePortion(document.getElementById("paifang_intro"),0.05,0.65,0.8);
        }
    }
    function drawImagePortion(img, px, py, pw, ph){
        if(isNaN(ph)){
            context.drawImage(img,px*canv.width,py*canv.height,pw*canv.width,img.height*pw*canv.width/img.width);
        }else{
            context.drawImage(img,px*canv.width,py*canv.height,pw*canv.width,ph*canv.height);
        }
    }
    function renderBackgroundImg(bg_img){
        w=canv.width;
        h=canv.height;
        renderwidth=w;
        renderheight=h;
        if(bg_img.width/bg_img.height>w/h){
            renderwidth=bg_img.width*h/bg_img.height;
            context.drawImage(bg_img,(w-renderwidth)/2,0,renderwidth,renderheight);
        }else{
            renderheight=bg_img.height*w/bg_img.width;
            context.drawImage(bg_img,0,(h-renderheight)/2,renderwidth,renderheight);
        }
    }
    function doclick(e){
        if(complete)
            return;
        ispc=canv.width>canv.height;
        if(ispc){
            if(isInPortion(e.x,e.y,0.05,0.05,0.2)||isInPortion(e.x,e.y,0.65,0.05,0.2)||isInPortion(e.x,e.y,0.65,0.5,0.4)){
                alert("这都能猜错？不会吧不会吧");
            }else if(isInPortion(e.x,e.y,0.35,0.05,0.2)){
                complete=true;
                renderCanvas();
                window.setInterval(displayIntro,50);
                $.ajax({
                method:"post",
                url:"setdata",
                data:{
                    "type":"paiFang"
                },
                success:function(data){
                    if(data==="成功")
                        console.log("成功上传数据。");
                    else
                        console.log("上传数据失败："+data);
                }
                });
            }
        }else{
            if(isInPortion(e.x,e.y,0.05,0.05,0.4)||isInPortion(e.x,e.y,0.05,0.35,0.4)||isInPortion(e.x,e.y,0.55,0.35,0.4)){
                alert("这都能猜错？不会吧不会吧");
            }else if(isIn(e.x,e.y,0.55,0.05,0.4)){
                complete=true;
                renderCanvas();
                window.setInterval(displayIntro,50);
                $.ajax({
                method:"post",
                url:"setdata",
                data:{
                    "type":"paiFang"
                },
                success:function(data){
                    if(data==="成功")
                        console.log("成功上传数据。");
                    else
                        console.log("上传数据失败："+data);
                }
                });
            }
        }
    }
    function isInPortion(x0, y0, px, py, pw){
        return isIn(x0,y0,px*canv.width,py*canv.height,pw*canv.width,300*pw*canv.width/400);
    }
    function isIn(x0,y0,x,y,w,h){
        return x0>x&&x0<(x+w)&&y0>y&&y0<(y+h);
    }
</script>
</body>
</html>